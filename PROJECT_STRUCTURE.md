# Dhikr Counter Project Structure

## Overview
This project implements an Apple Watch dhikr counter with research-validated motion sensor detection algorithms and a companion iPhone app for data analysis.

## Directory Structure

```
dhikr-counter/
â”œâ”€â”€ .gitignore                          # Git ignore file
â”œâ”€â”€ project.yml                         # XcodeGen configuration for watchOS app
â”œâ”€â”€ PROJECT_STRUCTURE.md                # This file
â”‚
â”œâ”€â”€ DhikrCounter/                       # iPhone Companion App
â”‚   â”œâ”€â”€ Assets.xcassets/                # iOS app assets
â”‚   â”œâ”€â”€ CompanionContentView.swift      # Main iOS app interface
â”‚   â”œâ”€â”€ DataVisualizationView.swift     # Analysis and visualization tools
â”‚   â”œâ”€â”€ DhikrCounterCompanionApp.swift  # iOS app entry point
â”‚   â””â”€â”€ Info.plist                     # iOS app configuration
â”‚
â”œâ”€â”€ DhikrCounter Watch App/             # Apple Watch App
â”‚   â”œâ”€â”€ Assets.xcassets/                # Watch app assets
â”‚   â”œâ”€â”€ ContentView.swift               # Main watch interface with counter
â”‚   â”œâ”€â”€ DhikrCounterApp.swift           # Watch app entry point
â”‚   â”œâ”€â”€ DhikrDetectionEngine.swift      # Core detection algorithm (research-validated)
â”‚   â”œâ”€â”€ Info.plist                     # Watch app configuration
â”‚   â”œâ”€â”€ MilestoneView.swift             # Milestone progress and dhikr information
â”‚   â””â”€â”€ SessionView.swift               # Session management and statistics
â”‚
â”œâ”€â”€ Shared/                            # Shared Data Models
â”‚   â”œâ”€â”€ DetectionEvent.swift           # Detection event data structure
â”‚   â””â”€â”€ SensorReading.swift            # Sensor data structure
â”‚
â”œâ”€â”€ DhikrCounter.xcodeproj/            # iOS App Xcode Project
â”‚   â””â”€â”€ project.pbxproj                # Generated by XcodeGen
â”‚
â”œâ”€â”€ DhikrCounterWatch.xcodeproj/       # Watch App Xcode Project
â”‚   â””â”€â”€ project.pbxproj                # Generated by XcodeGen
â”‚
â””â”€â”€ docs/                              # Documentation
    â”œâ”€â”€ README.md                      # Project overview and features
    â”œâ”€â”€ IMPLEMENTATION_PLAN.md         # Detailed implementation plan
    â”œâ”€â”€ dhikr_design_spec.md           # Original design specification
    â””â”€â”€ claude_code_briefing.md        # Development briefing document
```

## Key Components

### Apple Watch App (Primary)
- **DhikrDetectionEngine**: Research-validated pinch detection algorithm
  - 100Hz sensor sampling (accelerometer + gyroscope)
  - Multi-sensor fusion with adaptive thresholding
  - Session state management (inactive/setup/activeDhikr/paused)
  - Haptic feedback for pinches and milestones (33, 66, 100)
  - Comprehensive data logging

- **User Interface**: SwiftUI-based watchOS interface
  - Large counter display (60pt bold rounded font)
  - Progress tracking with milestone indicators
  - Session controls with Double Tap integration
  - No visual dependency during prayer

### iPhone Companion App (Development Tools)
- **Dashboard**: Project statistics and watch connection status
- **Data Analysis**: Timeline visualization and performance metrics
- **Settings**: Algorithm parameters and configuration
- **Export**: CSV data export for Jupyter analysis (Phase 3)

### Shared Models
- **SensorReading**: Timestamped sensor data with metadata
- **DetectionEvent**: Pinch detection events with confidence scores

## Implementation Status

### âœ… Phase 1 Complete (Weeks 1-2)
- [x] Research-validated detection algorithm implemented
- [x] SwiftUI interfaces for both iOS and watchOS
- [x] Core Motion sensor pipeline (100Hz sampling)
- [x] Haptic feedback system with milestone notifications
- [x] Session state management with activity-based transitions
- [x] Data logging infrastructure for development analysis
- [x] Apple Watch Series 9 Double Tap integration
- [x] Both apps successfully building and running in simulators

### ðŸ“‹ Phase 2 Pending (Weeks 2-3)
- [ ] Backward-looking pattern validation filter
- [ ] Enhanced session state management
- [ ] False positive elimination (<10% target)
- [ ] Support for varied dhikr rhythms (0.5s to 30s intervals)

### ðŸ“‹ Phase 3 Pending (Weeks 3-4)
- [ ] WatchConnectivity data transfer
- [ ] Timeline visualization with sensor overlays
- [ ] Manual annotation interface for ground truth
- [ ] CSV export system for Jupyter analysis

### ðŸ“‹ Phase 4 Pending (Weeks 4-5)
- [ ] Jupyter development environment setup
- [ ] Statistical validation framework
- [ ] Algorithm comparison and optimization tools
- [ ] Multi-session analysis pipeline

### ðŸ“‹ Phase 5 Pending (Weeks 5-6)
- [ ] Core ML model integration
- [ ] Automatic dhikr type recognition (80%+ accuracy)
- [ ] Personalized rhythm learning
- [ ] Advanced session analytics

## Technical Specifications

### Validated Algorithm Parameters
- **Accelerometer threshold**: 0.05g (high-pass filtered)
- **Gyroscope threshold**: 0.18 rad/s
- **Sampling rate**: 100Hz
- **Refractory period**: 250ms
- **Activity threshold**: 2.5 (70th percentile)

### Performance Targets
- **Detection accuracy**: 85-90% (research validated)
- **False positive rate**: <10% during active dhikr
- **Response latency**: <200ms for haptic feedback
- **Battery impact**: <5% additional drain per hour

## Development Workflow

### Building the Apps
```bash
# Generate iOS project and build
xcodegen generate
xcodebuild -project DhikrCounter.xcodeproj -scheme DhikrCounter -destination "platform=iOS Simulator,name=iPhone 16 Pro,arch=arm64" build

# Generate watchOS project and build
xcodegen generate --spec project.yml  # Uses watchOS configuration
xcodebuild -project DhikrCounterWatch.xcodeproj -scheme DhikrCounterWatch -destination "platform=watchOS Simulator,name=Apple Watch Series 10 (46mm),arch=arm64" build
```

### Running in Simulators
```bash
# Launch iOS companion app
xcrun simctl launch booted com.fuutaworks.DhikrCounter

# Launch watch app
xcrun simctl launch "Apple Watch Series 10 (46mm)" com.fuutaworks.DhikrCounterWatch
```

## Next Steps
1. **Real-world testing**: Deploy to physical Apple Watch for sensor validation
2. **Algorithm refinement**: Implement Phase 2 pattern validation filter
3. **Data connectivity**: Add WatchConnectivity for companion app integration
4. **Analysis pipeline**: Set up Jupyter environment for algorithm optimization

---

*Last updated: Phase 1 implementation complete with both apps running successfully in simulators*