
    <!DOCTYPE html>
    <html>
    <head>
        <title>Advanced TKEO Pinch Detection Report</title>
        <style>
            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background: #fafafa; }
            .header { 
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; 
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }
            .header h1 { margin: 0 0 15px 0; font-size: 24px; }
            .info-grid { 
                display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
                gap: 15px; font-size: 14px; 
            }
            .info-item { background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px; }
            .info-item strong { display: block; margin-bottom: 5px; }
            
            .section { margin: 25px 0; }
            .section h2 { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
            
            .metrics-grid { 
                display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
                gap: 15px; margin: 20px 0; 
            }
            .metric-card { 
                background: white; padding: 20px; border-radius: 10px; 
                box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-left: 4px solid #667eea;
            }
            .metric-card.validation-perfect {
                border-left: 4px solid #28a745; 
            }
            .metric-card.validation-warning {
                border-left: 4px solid #dc3545; 
            }
            .metric-value { font-size: 24px; font-weight: bold; color: #667eea; }
            .metric-label { color: #666; font-size: 14px; margin-top: 5px; }
            
            .config-table { 
                background: white; border-radius: 10px; overflow: hidden; 
                box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
            }
            .config-table table { border-collapse: collapse; width: 100%; margin: 0; }
            .config-table th { background: #667eea; color: white; padding: 12px; }
            .config-table td { padding: 12px; border-bottom: 1px solid #eee; }
            .config-table tr:last-child td { border-bottom: none; }
            
            .plot { text-align: center; margin: 30px 0; }
            .plot img { max-width: 100%; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
            
            .events-table { 
                background: white; border-radius: 10px; overflow: hidden; 
                box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
            }
            .events-table table { width: 100%; }
            .events-table th { background: #28a745; color: white; padding: 12px; }
            .events-table td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
            .events-table tr:nth-child(even) { background: #f8f9fa; }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>TKEO Pinch Detection Analysis</h1>
            <div class="info-grid">
                <div class="info-item">
                    <strong>Session</strong>
                    session_18B73D5B_1757191949.csv
                </div>
                <div class="info-item">
                    <strong>Duration</strong>
                    41.5 seconds
                </div>
                <div class="info-item">
                    <strong>Analysis Time</strong>
                    20:26:42
                </div>
                <div class="info-item">
                    <strong>Filter Range</strong>
                    3.0-20.0 Hz
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>Detection Results</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value">72</div>
                    <div class="metric-label">Final Detections</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">498</div>
                    <div class="metric-label">Gate Events</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">85.5%</div>
                    <div class="metric-label">Rejection Rate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">104.0</div>
                    <div class="metric-label">Events/Minute</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>Algorithm Configuration</h2>
            <div class="config-table">
                <table>
                    <tr><th>Parameter</th><th>Value</th></tr>
                    <tr><td>Template NCC Threshold</td><td>{detector.template_verifier.confidence_threshold}</td></tr>
                    <tr><td>Gate Thresholds</td><td>Accel: {detector.config['gate_k_accel']}σ, Gyro: {detector.config['gate_k_gyro']}σ</td></tr>
                    <tr><td>Fusion Weights</td><td>Accel: {detector.config['fusion_weight_accel']}, Gyro: {detector.config['fusion_weight_gyro']}</td></tr>
                    <tr><td>Refractory Period</td><td>{detector.config['refractory_period_s'] * 1000:.0f} ms</td></tr>
                </table>
            </div>
        </div>
        
        <div class="section">
            <h2>Detailed Analysis Plots</h2>
            <div class="plot">
                <img src="tkeo_detection_analysis.png" alt="TKEO Detection Analysis" style="width: 100%; height: auto;">
            </div>
        </div>
        
        <div class="section">
            <h2>Detected Events</h2>
            <div class="events-table">
                <table>
                    <tr><th>Event #</th><th>Time (s)</th><th>Confidence</th><th>Fusion Score</th></tr>
    
                    <tr>
                        <td>1</td>
                        <td>1.01</td>
                        <td>0.714</td>
                        <td>0.0926</td>
                    </tr>
        
                    <tr>
                        <td>2</td>
                        <td>1.25</td>
                        <td>0.669</td>
                        <td>0.1241</td>
                    </tr>
        
                    <tr>
                        <td>3</td>
                        <td>5.35</td>
                        <td>0.837</td>
                        <td>0.0169</td>
                    </tr>
        
                    <tr>
                        <td>4</td>
                        <td>5.55</td>
                        <td>1.038</td>
                        <td>0.1384</td>
                    </tr>
        
                    <tr>
                        <td>5</td>
                        <td>5.75</td>
                        <td>0.711</td>
                        <td>0.1959</td>
                    </tr>
        
                    <tr>
                        <td>6</td>
                        <td>5.95</td>
                        <td>0.869</td>
                        <td>0.0509</td>
                    </tr>
        
                    <tr>
                        <td>7</td>
                        <td>6.15</td>
                        <td>0.857</td>
                        <td>1.1611</td>
                    </tr>
        
                    <tr>
                        <td>8</td>
                        <td>6.35</td>
                        <td>0.732</td>
                        <td>0.2055</td>
                    </tr>
        
                    <tr>
                        <td>9</td>
                        <td>6.55</td>
                        <td>0.865</td>
                        <td>0.8117</td>
                    </tr>
        
                    <tr>
                        <td>10</td>
                        <td>6.81</td>
                        <td>0.729</td>
                        <td>0.2042</td>
                    </tr>
        
                    <tr>
                        <td>11</td>
                        <td>7.02</td>
                        <td>0.982</td>
                        <td>0.0420</td>
                    </tr>
        
                    <tr>
                        <td>12</td>
                        <td>7.22</td>
                        <td>0.905</td>
                        <td>0.0415</td>
                    </tr>
        
                    <tr>
                        <td>13</td>
                        <td>7.42</td>
                        <td>0.756</td>
                        <td>0.0912</td>
                    </tr>
        
                    <tr>
                        <td>14</td>
                        <td>7.62</td>
                        <td>0.840</td>
                        <td>0.0879</td>
                    </tr>
        
                    <tr>
                        <td>15</td>
                        <td>7.82</td>
                        <td>0.821</td>
                        <td>0.4146</td>
                    </tr>
        
                    <tr>
                        <td>16</td>
                        <td>8.02</td>
                        <td>0.665</td>
                        <td>0.0906</td>
                    </tr>
        
                    <tr>
                        <td>17</td>
                        <td>8.38</td>
                        <td>0.797</td>
                        <td>0.0926</td>
                    </tr>
        
                    <tr>
                        <td>18</td>
                        <td>8.58</td>
                        <td>0.908</td>
                        <td>1.1629</td>
                    </tr>
        
                    <tr>
                        <td>19</td>
                        <td>8.78</td>
                        <td>0.736</td>
                        <td>0.2056</td>
                    </tr>
        
                    <tr>
                        <td>20</td>
                        <td>8.99</td>
                        <td>0.717</td>
                        <td>0.0840</td>
                    </tr>
        
                    <tr>
                        <td>21</td>
                        <td>9.19</td>
                        <td>0.729</td>
                        <td>0.3149</td>
                    </tr>
        
                    <tr>
                        <td>22</td>
                        <td>9.43</td>
                        <td>0.724</td>
                        <td>0.3232</td>
                    </tr>
        
                    <tr>
                        <td>23</td>
                        <td>9.63</td>
                        <td>0.799</td>
                        <td>0.2027</td>
                    </tr>
        
                    <tr>
                        <td>24</td>
                        <td>9.83</td>
                        <td>0.821</td>
                        <td>0.0774</td>
                    </tr>
        
                    <tr>
                        <td>25</td>
                        <td>10.03</td>
                        <td>0.876</td>
                        <td>0.7646</td>
                    </tr>
        
                    <tr>
                        <td>26</td>
                        <td>10.39</td>
                        <td>0.847</td>
                        <td>0.1977</td>
                    </tr>
        
                    <tr>
                        <td>27</td>
                        <td>10.59</td>
                        <td>0.843</td>
                        <td>0.3578</td>
                    </tr>
        
                    <tr>
                        <td>28</td>
                        <td>10.95</td>
                        <td>0.882</td>
                        <td>0.1789</td>
                    </tr>
        
                    <tr>
                        <td>29</td>
                        <td>11.16</td>
                        <td>0.835</td>
                        <td>0.4455</td>
                    </tr>
        
                    <tr>
                        <td>30</td>
                        <td>11.36</td>
                        <td>0.718</td>
                        <td>0.5156</td>
                    </tr>
        
                    <tr>
                        <td>31</td>
                        <td>13.11</td>
                        <td>0.764</td>
                        <td>0.4372</td>
                    </tr>
        
                    <tr>
                        <td>32</td>
                        <td>13.31</td>
                        <td>0.656</td>
                        <td>0.4035</td>
                    </tr>
        
                    <tr>
                        <td>33</td>
                        <td>13.51</td>
                        <td>0.814</td>
                        <td>0.3067</td>
                    </tr>
        
                    <tr>
                        <td>34</td>
                        <td>13.97</td>
                        <td>1.045</td>
                        <td>0.3172</td>
                    </tr>
        
                    <tr>
                        <td>35</td>
                        <td>15.20</td>
                        <td>0.999</td>
                        <td>0.3872</td>
                    </tr>
        
                    <tr>
                        <td>36</td>
                        <td>15.72</td>
                        <td>0.826</td>
                        <td>0.4560</td>
                    </tr>
        
                    <tr>
                        <td>37</td>
                        <td>16.00</td>
                        <td>1.044</td>
                        <td>0.9616</td>
                    </tr>
        
                    <tr>
                        <td>38</td>
                        <td>16.74</td>
                        <td>0.895</td>
                        <td>0.4186</td>
                    </tr>
        
                    <tr>
                        <td>39</td>
                        <td>16.99</td>
                        <td>0.733</td>
                        <td>0.5376</td>
                    </tr>
        
                    <tr>
                        <td>40</td>
                        <td>17.19</td>
                        <td>0.922</td>
                        <td>1.1807</td>
                    </tr>
        
                    <tr>
                        <td>41</td>
                        <td>17.39</td>
                        <td>0.820</td>
                        <td>0.9211</td>
                    </tr>
        
                    <tr>
                        <td>42</td>
                        <td>17.67</td>
                        <td>0.716</td>
                        <td>0.4778</td>
                    </tr>
        
                    <tr>
                        <td>43</td>
                        <td>17.87</td>
                        <td>0.875</td>
                        <td>0.6908</td>
                    </tr>
        
                    <tr>
                        <td>44</td>
                        <td>18.07</td>
                        <td>0.853</td>
                        <td>0.6215</td>
                    </tr>
        
                    <tr>
                        <td>45</td>
                        <td>18.87</td>
                        <td>0.720</td>
                        <td>0.4298</td>
                    </tr>
        
                    <tr>
                        <td>46</td>
                        <td>19.08</td>
                        <td>0.749</td>
                        <td>0.4493</td>
                    </tr>
        
                    <tr>
                        <td>47</td>
                        <td>19.34</td>
                        <td>0.950</td>
                        <td>0.4896</td>
                    </tr>
        
                    <tr>
                        <td>48</td>
                        <td>20.22</td>
                        <td>0.817</td>
                        <td>0.7506</td>
                    </tr>
        
                    <tr>
                        <td>49</td>
                        <td>21.73</td>
                        <td>0.713</td>
                        <td>0.6885</td>
                    </tr>
        
                    <tr>
                        <td>50</td>
                        <td>21.93</td>
                        <td>0.806</td>
                        <td>0.8201</td>
                    </tr>
        
                    <tr>
                        <td>51</td>
                        <td>23.06</td>
                        <td>0.929</td>
                        <td>0.5101</td>
                    </tr>
        
                    <tr>
                        <td>52</td>
                        <td>25.41</td>
                        <td>0.807</td>
                        <td>0.4920</td>
                    </tr>
        
                    <tr>
                        <td>53</td>
                        <td>25.99</td>
                        <td>0.665</td>
                        <td>0.6177</td>
                    </tr>
        
                    <tr>
                        <td>54</td>
                        <td>26.19</td>
                        <td>0.894</td>
                        <td>0.8996</td>
                    </tr>
        
                    <tr>
                        <td>55</td>
                        <td>27.12</td>
                        <td>0.897</td>
                        <td>0.6487</td>
                    </tr>
        
                    <tr>
                        <td>56</td>
                        <td>27.58</td>
                        <td>1.004</td>
                        <td>0.6638</td>
                    </tr>
        
                    <tr>
                        <td>57</td>
                        <td>29.69</td>
                        <td>0.908</td>
                        <td>0.5725</td>
                    </tr>
        
                    <tr>
                        <td>58</td>
                        <td>30.92</td>
                        <td>0.967</td>
                        <td>0.5630</td>
                    </tr>
        
                    <tr>
                        <td>59</td>
                        <td>31.18</td>
                        <td>0.656</td>
                        <td>1.5843</td>
                    </tr>
        
                    <tr>
                        <td>60</td>
                        <td>31.38</td>
                        <td>0.862</td>
                        <td>43.4538</td>
                    </tr>
        
                    <tr>
                        <td>61</td>
                        <td>31.58</td>
                        <td>0.840</td>
                        <td>5.2618</td>
                    </tr>
        
                    <tr>
                        <td>62</td>
                        <td>31.78</td>
                        <td>0.877</td>
                        <td>5.2112</td>
                    </tr>
        
                    <tr>
                        <td>63</td>
                        <td>32.00</td>
                        <td>0.909</td>
                        <td>0.7258</td>
                    </tr>
        
                    <tr>
                        <td>64</td>
                        <td>32.24</td>
                        <td>0.739</td>
                        <td>0.8958</td>
                    </tr>
        
                    <tr>
                        <td>65</td>
                        <td>32.44</td>
                        <td>0.746</td>
                        <td>2.9086</td>
                    </tr>
        
                    <tr>
                        <td>66</td>
                        <td>32.64</td>
                        <td>0.694</td>
                        <td>0.9796</td>
                    </tr>
        
                    <tr>
                        <td>67</td>
                        <td>33.99</td>
                        <td>0.768</td>
                        <td>0.8951</td>
                    </tr>
        
                    <tr>
                        <td>68</td>
                        <td>34.19</td>
                        <td>0.813</td>
                        <td>0.9023</td>
                    </tr>
        
                    <tr>
                        <td>69</td>
                        <td>34.59</td>
                        <td>0.666</td>
                        <td>0.9286</td>
                    </tr>
        
                    <tr>
                        <td>70</td>
                        <td>34.79</td>
                        <td>0.842</td>
                        <td>2.4440</td>
                    </tr>
        
                    <tr>
                        <td>71</td>
                        <td>35.94</td>
                        <td>0.723</td>
                        <td>0.9245</td>
                    </tr>
        
                    <tr>
                        <td>72</td>
                        <td>36.16</td>
                        <td>0.962</td>
                        <td>1.4617</td>
                    </tr>
        
                </table>
            </div>
        </div>
        
        <div class="section">
            <h2>Algorithm Notes</h2>
            <p><strong>Two-Stage Detection:</strong></p>
            <ul>
                <li><strong>Stage 1 (Gate):</strong> Liberal TKEO-based burst detection with adaptive thresholds</li>
                <li><strong>Stage 2 (Verify):</strong> Template matching via normalized cross-correlation</li>
            </ul>
            <p><strong>Signal Processing Pipeline:</strong></p>
            <ol>
                <li>Band-pass filtering (3-20 Hz) - captures transient energy</li>
                <li>Jerk computation - emphasizes rapid changes</li>
                <li>TKEO operator - detects instantaneous energy bursts</li>
                <li>Adaptive baseline tracking - handles varying noise levels</li>
                <li>Template verification - reduces false positives</li>
            </ol>
        </div>
    </body>
    </html>
    